<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grand Rapids Record Club</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body class="bg-gray-900 text-white">
<div class="container mx-auto p-6">
    <h1 class="text-4xl font-bold text-center">Grand Rapids Record Club ðŸŽµ</h1>
    <p class="text-center mt-2">A group of friends exploring a new album each month.</p>

    <!-- Dropdowns for filtering -->
    <div class="mt-6 flex space-x-4">
        <div class="flex flex-col">
            <label for="yearFilter">Year</label>
            <select id="yearFilter" class="p-2 text-black rounded" onchange="searchAlbums()">
                <option value="">All Years</option>
                <!-- Year options will be populated dynamically -->
            </select>
        </div>
        <div class="flex flex-col">
            <label for="genreFilter">Genre</label>
            <select id="genreFilter" class="p-2 text-black rounded" onchange="searchAlbums()">
                <option value="">All Genres</option>
                <!-- Genre options will be populated dynamically -->
            </select>
        </div>
        <div class="flex flex-col">
            <label for="hostFilter">Host</label>
            <select id="hostFilter" class="p-2 text-black rounded" onchange="searchAlbums()">
                <option value="">All Hosts</option>
                <!-- Host options will be populated dynamically -->
            </select>
        </div>
    </div>

    <div class="mt-4">
        <input type="text" id="searchBar" class="w-full p-2 text-black rounded" placeholder="Search for an album..." oninput="searchAlbums()">
    </div>

    <div id="album-container" class="mt-4"></div>

    <!-- Modal for displaying album details -->
    <div id="album-details-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 hidden">
        <div class="container mx-auto p-6 bg-gray-900 rounded-lg mt-20 max-w-3xl">
            <div id="album-details-content" class="text-white">
                <!-- Album details will be injected here -->
            </div>
            <button onclick="closeModal()" class="mt-4 bg-red-500 text-white px-4 py-2 rounded">Close</button>
        </div>
    </div>
</div>

<script>
const API_KEY = "33ba6c5c9f098d1131ad8cd253b17e26"; // Last.fm API key

const albums = [
    {
        month: "March",
        year: "2025",
        artist: "The Band",
        title: "The Band",
        hostedBy: "Mike",
        releaseDate: "1969-09-22",  // Actual release date
        genre: "Rock"
    },
    {
        month: "February",
        year: "2025",
        artist: "Ween",
        title: "Quebec",
        hostedBy: "Justin",
        releaseDate: "2003-03-04",  // Actual release date
        genre: "Alternative Rock"
    },
    {
        month: "December",
        year: "2024",
        artist: "Primus",
        title: "Sailing The Seas of Cheese",
        hostedBy: "Scott",
        releaseDate: "1991-05-24",  // Actual release date
        genre: "Funk Metal"
    }
];

function populateDropdowns() {
    const years = [...new Set(albums.map(album => album.year))].sort();
    const genres = [...new Set(albums.map(album => album.genre))].sort();
    const hosts = [...new Set(albums.map(album => album.hostedBy))].sort();

    const yearDropdown = document.getElementById("yearFilter");
    const genreDropdown = document.getElementById("genreFilter");
    const hostDropdown = document.getElementById("hostFilter");

    years.forEach(year => {
        const option = document.createElement("option");
        option.value = year;
        option.textContent = year;
        yearDropdown.appendChild(option);
    });

    genres.forEach(genre => {
        const option = document.createElement("option");
        option.value = genre;
        option.textContent = genre;
        genreDropdown.appendChild(option);
    });

    hosts.forEach(host => {
        const option = document.createElement("option");
        option.value = host;
        option.textContent = host;
        hostDropdown.appendChild(option);
    });
}

async function fetchAlbumCover(artist, album) {
    const url = `https://ws.audioscrobbler.com/2.0/?method=album.getinfo&api_key=${API_KEY}&artist=${encodeURIComponent(artist)}&album=${encodeURIComponent(album)}&format=json`;

    try {
        const response = await fetch(url);
        const data = await response.json();

        if (data.album && data.album.image) {
            return data.album.image[3]["#text"]; // The largest available image
        }
    } catch (error) {
        console.error("Error fetching album cover:", error);
    }
    return "default_album_cover.jpg"; // Fallback image if not found
}

async function fetchAlbumDetails(artist, album) {
    const url = `https://ws.audioscrobbler.com/2.0/?method=album.getinfo&api_key=${API_KEY}&artist=${encodeURIComponent(artist)}&album=${encodeURIComponent(album)}&format=json`;

    try {
        const response = await fetch(url);
        const data = await response.json();

        if (data.album) {
            return data.album;
        }
    } catch (error) {
        console.error("Error fetching album details:", error);
    }
    return null;
}

async function displayAlbums(filteredAlbums = albums) {
    const albumContainer = document.getElementById("album-container");
    albumContainer.innerHTML = "";

    for (const album of filteredAlbums) {
        const coverUrl = await fetchAlbumCover(album.artist, album.title);

        const div = document.createElement("div");
        div.className = "bg-gray-800 p-3 rounded-lg flex items-center space-x-4 cursor-pointer";
        div.onclick = () => showAlbumDetails(album.artist, album.title); // Add click event to show details

        const img = document.createElement("img");
        img.src = coverUrl;
        img.className = "w-16 h-16 rounded";

        const text = document.createElement("p");
        text.textContent = `${album.month} ${album.year}: ${album.title} - ${album.artist}`;

        div.appendChild(img);
        div.appendChild(text);
        albumContainer.appendChild(div);
    }
}

function searchAlbums() {
    const query = document.getElementById("searchBar").value.toLowerCase();
    const yearQuery = document.getElementById("yearFilter").value;
    const genreQuery = document.getElementById("genreFilter").value;
    const hostQuery = document.getElementById("hostFilter").value;

    const filteredAlbums = albums.filter(album =>
        (album.title.toLowerCase().includes(query) ||
        album.artist.toLowerCase().includes(query) ||
        album.month.toLowerCase().includes(query) ||
        album.year.includes(query)) &&
        (yearQuery ? album.year === yearQuery : true) &&
        (genreQuery ? album.genre === genreQuery : true) &&
        (hostQuery ? album.hostedBy === hostQuery : true)
    );
    displayAlbums(filteredAlbums);
}

async function showAlbumDetails(artist, album) {
    const albumDetails = await fetchAlbumDetails(artist, album);

    if (albumDetails) {
        const detailsContent = document.getElementById("album-details-content");

        // Fetch additional info from albums array
        const albumInfo = albums.find(a => a.artist === artist && a.title === album);

        const releaseDate = albumInfo ? albumInfo.releaseDate : (albumDetails.release_date || "Unknown");
        const genre = albumInfo ? albumInfo.genre : (albumDetails.toptags?.tag[0]?.name || "Unknown");
        const hostedBy = albumInfo ? albumInfo.hostedBy : "Unknown";

        detailsContent.innerHTML = `
            <h2 class="text-2xl font-bold">${albumDetails.name} - ${artist}</h2>
            <br>
            <p><strong>Release Date:</strong> ${releaseDate}</p>
            <br>
            <p><strong>Genre:</strong> ${genre}</p>
            <br>
            <p><strong>Hosted By:</strong> ${hostedBy}</p>
            <br>
            <p><strong>Album Info:</strong> ${albumDetails.wiki?.summary || "No description available."}</p>
            <img src="${albumDetails.image[3]["#text"]}" class="mt-4 w-48 h-48 rounded" alt="${albumDetails.name}">
        `;

        document.getElementById("album-details-modal").classList.remove("hidden");
    }
}

// Function to close the modal
function closeModal() {
    document.getElementById("album-details-modal").classList.add("hidden");
}

// Populate dropdowns when the page loads
populateDropdowns();
displayAlbums();
</script>
</body>
</html>
